#!/bin/bash

DIRECTORY="$(dirname "$(dirname "$( cd "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )")")"

function error {
  echo -e "\\e[91m$1\\e[39m"
  exit 1
}

# Install flatpak first 
"${DIRECTORY}/pkg-install" "flatpak" "$(dirname "$0")" || error "Failed installing Flatpak!"

( sudo flatpak install flathub org.telegram.desktop -y || flatpak install flathub org.telegram.desktop -y ) || error "Failed installing Telegram!"

# Create menu shortcut
echo "[Desktop Entry]
Name=Telegram
Exec=flatpak run org.telegram.desktop
Icon=$(dirname "$0")/icon-64.png
Terminal=false
StartupNotify=true
Type=Application
Categories=Network;" > ~/.local/share/applications/telegram.desktop || error "Failed to create menu shortcut!"
